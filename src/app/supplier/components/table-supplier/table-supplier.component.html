<form class="mb-2">
  <div class="flex">


    <mat-form-field class="relative w-full">
      <input matInput placeholder="Search product name..." #input type="search" id="search-dropdown"
             class="block p-2.5 w-full z-20 text-sm text-gray-900 bg-gray-50 rounded border-l-gray-50 border-l-2 border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-l-gray-700  dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:border-blue-500"
             required (keyup)="applyFilter($event)">

    </mat-form-field>

    <button
      class=" ml-2 block w-2/12 p-2 mb-6 text-sm text-white font-bold border uppercase rounded-full bg-green-500 hover:bg-green-600 active:bg-green-700 focus:outline-none  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
      (click)="openToAdd(); dialog.showModal()"> + Cultivate
    </button>
    <!--        <select id="small" class="block w-2/12 p-2 mb-6 text-sm text-gray-900 border border-gray-300 rounded-r-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">-->
    <!--          <option selected>All status</option>-->
    <!--          <option value="US">United States</option>-->
    <!--          <option value="CA">Canada</option>-->
    <!--          <option value="FR">France</option>-->
    <!--          <option value="DE">Germany</option>-->
    <!--        </select>-->
  </div>
</form>
<table mat-table [dataSource]="dataSourceProduct" class=" min-h-max">


  <!--- Note that these columns can be defined in any order.
      The actual rendered columns are set as a property on the row definition" -->

  <!-- Position Column -->
  <ng-container matColumnDef="index">
    <th mat-header-cell *matHeaderCellDef> No.</th>
    <td mat-cell *matCellDef="let i = index"> {{i + 1}} </td>
  </ng-container>


  <!-- Weight Column -->
  <ng-container matColumnDef="productName">
    <th mat-header-cell *matHeaderCellDef> Product name</th>
    <td mat-cell *matCellDef="let element"> {{element.productName}} </td>
  </ng-container>

  <!-- Symbol Column -->
  <ng-container matColumnDef="cultivatedDate">
    <th mat-header-cell *matHeaderCellDef> Cultivated date</th>
    <td mat-cell *matCellDef="let element"> {{element.dates.cultivated | date: 'dd - MMM - yyyy'}} </td>
  </ng-container>
  <ng-container matColumnDef="harvestedDate">
    <th mat-header-cell *matHeaderCellDef> Harvested date</th>
    <td mat-cell *matCellDef="let element"> {{element.dates.harvested | date: 'dd - MMM - yyyy'}} </td>
  </ng-container>
  <ng-container matColumnDef="price">
    <th mat-header-cell *matHeaderCellDef> Price</th>
    <td mat-cell *matCellDef="let element"> {{element.price | currency : 'VND'}} </td>
  </ng-container>
  <ng-container matColumnDef="status">
    <th mat-header-cell *matHeaderCellDef> Status</th>
    <td mat-cell *matCellDef="let element">
      <i class="fa-solid fa-circle {{element.status.toUpperCase()}}"></i> {{element.status}}
    </td>
  </ng-container>
  <ng-container matColumnDef="action">
    <th mat-header-cell *matHeaderCellDef> Action</th>
    <td mat-cell *matCellDef="let element">
      <button type="button"
              class="mr-3 fa-solid focus:outline-none fa-pen-to-square text-base text-blue-500 hover:text-blue-600 transition-colors duration-300 ease-in-out transform"
              (click)="open(element);dialog.showModal();"></button>
      <button type="button"
              class="fa-solid focus:outline-none fa-trash-can text-base text-red-500 hover:text-red-600 transition-colors duration-300 ease-in-out transform"></button>
    </td>
  </ng-container>
  <tr mat-header-row *matHeaderRowDef="displayProductColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayProductColumns;"></tr>
</table>
<mat-paginator #productPaginator [pageSizeOptions]="[10, 25, 100]" aria-label="Select page of users"></mat-paginator>
<dialog [ngClass]="openDialog ? 'flex':'hidden'" class=" relative flex-col bg-blueGray-100 rounded-lg w-5/6" #dialog>
  <div class="backdrop" (mousedown)="onBackdropClick($event)"></div>
  <p class="text-xl font-medium" *ngIf="!isCreate">Update product</p>
  <p class="text-xl font-medium" *ngIf="isCreate">Cultivate product</p>

  <button type="button" class="absolute top-2 right-6 focus:outline-none text-xl font-bold text-red-600"
          (click)="close(true, false)">X
  </button>

  <!--    <app-detail-product [product]="product" [reload]="reloadDetailProduct" (dataEvent)="close($event)" *ngIf="openDialog"></app-detail-product>-->

  <form (ngSubmit)="onSubmit()">
    <div class="2xl:container 2xl:mx-auto lg:py-16 lg:px-20 md:py-12 md:px-6 py-9 px-4">
      <div class="flex justify-center items-center lg:flex-row flex-col gap-8">
        <div class="w-full ">
          <div style="height: 40vh; width: 100%;" class="mb-2">
            <!--            <carousel [imageList]="item.productObj.image" *ngIf="!isCreateForm && item.productObj.image">-->
            <!--              >-->
            <!--            </carousel>-->
            <!--            <app-post-image *ngIf="isCreateForm" (dataEvent)="addImage($event)">-->

            <!--            </app-post-image>-->

            <div style="display: flex; flex-direction: column; height: 100%; width: 100%;">
              <div style=" flex: 5">
                <div
                  style="position: relative; background-size: contain; background-position: center; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; height: 100%; background-repeat: no-repeat;"
                  [ngStyle]="{'background-image': imageList && imageList.length > 0 ? 'url('+ imageList![currentImagePos] +' ) ': 'url(https://firebasestorage.googleapis.com/v0/b/supply-chain-9ea64.appspot.com/o/signatureimg%2Fhình%20ảnh_2023-06-14_094736470.png?alt=media&token=88d5e1bc-84a7-4849-8b76-65d8e965e413&_gl=1*y6x5nc*_ga*MTM3MTA5MTU2LjE2ODUwOTY5NjU.*_ga_CW55HF8NVT*MTY4NjcxMDgzNi41LjEuMTY4NjcxMDg2MC4wLjAuMA..) '}"
                >
                  <div style="position: absolute; right: 7px; top: 7px;">
                    <label for="file-input" >
                      <mat-icon class="rounded-md bg-aliceblue h-35 w-35 bg-blueGray-100 " *ngIf="!isImageLoading">library_add</mat-icon>

                      <app-loading [isLoading]="isImageLoading"></app-loading>
                    </label>
                    <input *ngIf="!isImageLoading" id="file-input" type="file" accept="image/png, image/gif, image/jpeg"
                           style="height: 1px; width: 1px; opacity: 0; "
                           (change)="addImage($event)"/>
                  </div>
                  <div class="rounded-md bg-aliceblue h-35 w-35 bg-blueGray-100 "
                       (click)="previousImage()" *ngIf="imageList.length > 1">
                    <svg class="h-8 w-8 text-black"
                         width="24" height="24"
                         viewBox="0 0 24 24"
                         stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                         stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z"/>
                      <line x1="5" y1="12" x2="19" y2="12"/>
                      <line x1="5" y1="12" x2="11" y2="18"/>
                      <line x1="5" y1="12" x2="11" y2="6"/>
                    </svg>
                  </div>
                  <div class="rounded-md bg-aliceblue h-35 w-35 bg-blueGray-100 " (click)="afterImage()" *ngIf="imageList.length > 1">
                    <svg class="h-8 w-8 text-black" width="24" height="24" viewBox="0 0 24 24"
                         stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round"
                         stroke-linejoin="round">
                      <path stroke="none" d="M0 0h24v24H0z"/>
                      <line x1="5" y1="12" x2="19" y2="12"/>
                      <line x1="13" y1="18" x2="19" y2="12"/>
                      <line x1="13" y1="6" x2="19" y2="12"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div (drag)="moveImages($event)" (dragend)="endDrag($event)" id="imageThumnailContain" class="mt-2"
                   style="position: relative;flex: 1; align-items: center; justify-content: center; overflow: hidden;">
                <div id="imageThumnails"
                     style="position: absolute;height: 100%; display: flex; align-items: center; padding: 0 5px;"
                     [style.left]="distanceString" (dragstart)="getFirstPos($event)">
                  <div *ngFor="let image of imageList; let i = index"
                       [ngStyle]="{ 'border': i === currentImagePos ? '2px solid' : '', 'background-image': 'url(' + image + ')' }"
                       style="background-repeat: no-repeat; object-fit: cover; background-position: center; display: inline; float: left; height: 100%; width: 110px;
            border-radius: 10px; background-size: contain; margin: 0 5px;"
                       (click)="chooseImage(i)">

                    <div style="float: right; height: 20px; width: 20px; background-color: rgb(255, 255, 255);
       opacity: 0.9;
       display: flex; justify-content: center; align-items: center; border-radius: 100px; margin-top: 2px; margin-right: 2px;"
                         stopPropagation
                    >
                      <button type="button" class="fa fa-times" aria-hidden="true" style="float: right;"
                              (click)="deleteImage(i)"></button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="flex justify-around mb-2 mt-5">
            <button type="button"
                    class="w-3/12 border bg-red-500 text-white active:bg-red-600 font-bold uppercase text-xs px-4 py-2 rounded-lg shadow hover:shadow-md outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150"
                    (click)="close()">Cancel
            </button>

            <button type="button"
                    class="justify-center border bg-yellow-400 text-white active:bg-yellow-600 font-bold uppercase text-xs px-4 py-2 rounded-lg shadow hover:shadow-md outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150"
                    (click)="harvestProduct(product.productId)"
                    *ngIf="product.status.toLowerCase() == 'cultivating' || product.status.toLowerCase() == 'cultivated'">
              Harvest this product!
            </button>
            <button type="submit"
                    class="w-3/12 border text-white font-bold uppercase text-xs px-4 py-2 rounded-lg shadow hover:shadow-md outline-none focus:outline-none mr-1 mb-1 ease-linear transition-all duration-150"
                    [disabled]="!product.productName || !product.amount || product.image == null || product.image.length == 0"
                    [ngClass]="!product.productName || !product.amount || product.image == null || product.image.length == 0 ? 'bg-slate-400' : 'bg-green-500 hover:bg-green-600'">
              Submit
            </button>
          </div>
        </div>
        <div class="w-full sm:w-96 md:w-8/12 lg:w-6/12 items-center">
          <h2 class="font-semibold lg:text-4xl text-3xl lg:leading-9 leading-7 text-gray-800 mt-4">
            <input class="border-none font-semibold lg:text-4xl text-3xl lg:leading-9 leading-7 text-gray-800 rounded-lg placeholder-gray-300"
                   type="text"
                   placeholder="Product Name"
                   id="productNameEd" name="productName" [(ngModel)]="product.productName">

          </h2>
          <div>

            <p class="font-medium text-base leading-4 text-gray-600">Certificate:
              <button type="button" class="w-1/12 h-1/12 focus:outline-none"
                (click)="openCertificate();dialogCert.showModal()"
              >
                <mat-icon *ngIf="product.certificateUrl==''">add_a_photo</mat-icon>
                <!--                <mat-icon>library_add</mat-icon>-->
                <mat-icon *ngIf="product.certificateUrl!=''"> remove_red_eye</mat-icon>
              </button>

            </p>

          </div>


          <p class=" mt-7"><textarea rows="10"
                                     class="border-none w-full justify-center font-normal text-base leading-6 text-gray-600 rounded-lg placeholder-gray-300"
                                     id="description"
                                     name="description"
                                     placeholder="Description"
                                     [(ngModel)]="product.description">{{ product.description }}</textarea>
          </p>
          <div class="flex flex-row justify-between">
            <p class="font-medium text-base leading-4 text-gray-600">Price(vnd)</p>
            <p class=" mt-6">


              <input class="border-none font-semibold lg:text-2xl text-xl lg:leading-6 leading-5 text-right rounded-lg placeholder-gray-300" type="text"
                     placeholder="Unit Price"
                     id="priceEd" name="price" [(ngModel)]="product.price ">
            </p>

          </div>


          <div class="lg:mt-11 mt-10">
            <div class="flex flex-row justify-between">
              <p class="font-medium text-base leading-4 text-gray-600">Amount</p>
              <div class="flex justify-end">
                <input class="w-3/6 rounded-l border-none placeholder-gray-300"
                       placeholder="0"
                       type="number" id="amountCR" name="amount"
                       [(ngModel)]="product.amount" pattern="[0-9]*">
                <select class="w-3/12 border-none rounded-r focus:outline-none" [(ngModel)]="product.unit" name="unit">
                  <option *ngFor="let unit of units" [value]="unit">{{ unit }}</option>
                </select>
              </div>

            </div>
            <hr class="bg-gray-200 w-full my-2"/>
            <div class="flex flex-row justify-between items-center mt-4">
              <div class="mr-1">
                <label for="cultivatedDate" class="font-medium text-base leading-4 text-gray-600"
                >Cultivated
                  Date:</label>
                <br>
                <input type="text" id="cultivatedDate" name="cultivatedDate" class="border-0 rounded-lg" *ngIf="product.dates[0]"
                       [value]="product.dates[0].time | date: 'dd - MMM - yyyy HH:mm:ss'" disabled>
                <input
                  class="rounded-lg border-none"
                  type="text" name="currentDate" [value]="currentDate | date: 'dd - MMM - yyyy'" *ngIf="!product.dates[0]" disabled>
              </div>
              <div class="ml-1 ">
                <label for="harvestedDate" class="font-medium text-base leading-4 text-gray-600">Harvested Date:</label>
                <br>
                <input type="text" id="harvestedDate" name="harvestedDate" class="border-0 rounded-lg" *ngIf="product.dates[1]"
                       [value]="product.dates[1].time | date: 'dd - MMM - yyyy HH:mm:ss'" disabled>
                <input
                  class="rounded-lg border-none"
                  type="text" name="harvestedDate" [value]="'dd - MMM - yyyy'" *ngIf="!product.dates[1]" disabled>
              </div>
            </div>
            <hr class="bg-gray-200 w-full mt-4"/>
          </div>
        </div>
      </div>
    </div>
  </form>


  <dialog [ngClass]="openCertification ? 'flex':'hidden'" class="relative flex-col bg-blueGray-100 rounded-lg w-1/3"
          #dialogCert>
    <p class="text-xl font-medium" *ngIf="product.certificateUrl!=''">Certificate</p>
    <p class="text-xl font-medium" *ngIf="product.certificateUrl==''">Add Certificate</p>
    <button type="button" class="absolute top-2 right-6 focus:outline-none text-xl font-bold text-red-600"
            (click)="closeCertificate()">X
    </button>

<!--    <app-certificate [product]="product"></app-certificate>-->

    <form (ngSubmit)="onSubmitCertificate()">
      <a href="{{ imageUrl }}" target="_blank"  *ngIf="imageUrl!=''">
        <div style="width: 100%; position: relative; background-size: contain; background-position: center; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; height: 30vh; background-repeat: no-repeat;"
             [ngStyle]="{'background-image': 'url('+ imageUrl +' )'}">
          <label for="cert-update">
            <mat-icon >add_photo_alternate</mat-icon>
            <app-loading [isLoading] = "isImageLoading"></app-loading>
          </label>
          <input *ngIf="!isImageLoading" id="cert-update" type="file" accept="image/png, image/jpeg" style="height: 1px; width: 1px; opacity: 0; "
                 (change)="addCert($event)" />
        </div>
      </a>
      <div
        *ngIf="imageUrl==''"
        style="position: relative; background-size: contain; background-position: center; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; background-repeat: no-repeat;"
           [ngStyle]="{'background-image': 'url('+ imageUrl +' )'}">
        <label for="cert-input">
          <mat-icon >add_photo_alternate</mat-icon>
          <app-loading [isLoading] = "isImageLoading"></app-loading>
        </label>
        <input *ngIf="!isImageLoading" id="cert-input" type="file" accept="image/png, image/jpeg" style="height: 1px; width: 1px; opacity: 0; "
               (change)="addCert($event)" />
      </div>
      <button type="submit">
        Confirm
      </button>
    </form>


  </dialog>
</dialog>
